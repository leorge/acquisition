#!/usr/bin/bash
LANG=C
if [ $# -lt 1 ]; then
    echo "usage : [size=16] [repeat=1] $0  N1, N2, N3..."
    exit
fi

rm -f tmp\[0-9\]*

sed -i -e '1,/^@/!d' $0     # Delete data part
echo "start    : `date -u`" >> $0       # add date
echo "computer : `uname -norpv`" >> $0
echo "CPU      : `lscpu | grep 'Model name:' | sed 's/^\S* \S* *//'`" >> $0
echo "operator : `id -un`" >> $0
echo "size     : ${size:=16}" >> $0
echo "repeat   : ${repeat:=1}" >> $0
echo "option   : $*" >> $0

#
# search boundary between quicksort and mergesort
#

for i in `seq 1 $repeat`; do echo "$0 `date` $i/$repeat" >&2
    random.awk `echo 2^20 | bc` > data
    for N in $*; do echo -n " $N" >&2
        echo "$i:$N"
        Release/Sort -N $N -Z $size -hqm data
    done
    echo "" >&2
done > tmp$$
echo "stop     : `date -u`" >> $0       # add date

OUT=tmp.`basename $0`
et.awk -v 'x=log2(N)' tmp$$ > $OUT
expand -t `col.awk $OUT` $OUT | tee -a $0
echo "Raw data is in a file tmp$$"

exit


$ size=256 repeat=20 ./$0 1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072

start    : Sat May  5 04:07:20 UTC 2018
computer : archiso 4.8.6-1-ARCH #1 SMP PREEMPT Mon Oct 31 18:51:30 CET 2016 unknown GNU/Linux
CPU      : AMD FX(tm)-8300 Eight-Core Processor
operator : root
size     : 256
repeat   : 20
option   : 1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
stop     : Sat May  5 04:11:54 UTC 2018
1
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      168  241  801  560  825  1623 2326 3534  4813  7114  10222 16199 24081 37998 56084
quick_hole()  175  266  383  586  848  1513 2172 3322  5286  7243  10394 16480 25261 36824 55670
asymm_qsort() 407  269  394  611  880  1511 2302 3369  4898  7182  10505 15938 23860 36018 54442
merge_array() 243  352  522  806  1209 2207 3141 4711  6900  11073 16787 25937 38750 58378 89662

2
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      168  298  374  534  830  1626 2326 3358  4672  7268  10123 16602 23682 37794 56253
quick_hole()  174  293  388  564  884  1554 2188 3747  5098  7279  10290 15997 24522 37146 60911
asymm_qsort() 177  271  407  577  902  1497 2318 3378  4765  7264  10733 15833 24325 36269 57608
merge_array() 237  351  524  788  1257 2241 3235 4739  6841  11074 16745 25976 39070 58232 90613

3
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      518  770  377  553  810  1649 2327 3758  4722  7246  10074 16439 24186 38572 55277
quick_hole()  171  260  380  559  860  1576 2324 3400  5026  7017  10614 15698 25145 37931 54806
asymm_qsort() 179  266  392  582  875  1539 2286 3331  4840  7228  10593 15692 24980 38038 54783
merge_array() 239  362  520  786  1242 2214 3261 4745  6838  11066 16871 25898 40644 58443 90132

4
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      169  253  373  554  802  1647 2276 3352  4867  7262  10288 16463 24093 38646 56062
quick_hole()  179  255  387  568  880  1637 2337 3424  4776  7846  11106 16456 25166 37544 56930
asymm_qsort() 186  266  401  600  898  1549 2274 3327  4778  7201  10630 16566 25008 36917 55393
merge_array() 240  356  519  797  1251 2247 3236 4713  6863  11134 16812 26170 39365 58705 90630

5
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      515  255  373  565  841  1648 2350 3338  4816  7185  10298 16417 24091 37779 55302
quick_hole()  177  262  380  579  857  1739 2336 3229  5058  7422  10437 16141 24543 37393 56319
asymm_qsort() 180  274  403  613  888  1563 2241 3299  4860  7178  10718 15860 24982 36431 54556
merge_array() 236  362  528  825  1233 2246 3223 4664  6835  10905 17094 25927 39141 58630 89821

6
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      511  243  371  556  842  1622 2341 3525  4841  7185  10103 16384 23584 38630 55839
quick_hole()  176  250  390  573  867  1586 2286 3407  4946  7051  10595 15982 24572 37362 55302
asymm_qsort() 178  262  401  597  877  1588 2298 3342  4824  7152  10473 16256 24290 36210 54733
merge_array() 237  352  522  822  1246 2271 3255 4688  6906  10880 16838 26269 39094 58275 89984

7
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      244  363  791  538  824  1623 2264 3569  4814  7258  10227 16412 24097 38705 55981
quick_hole()  270  395  383  583  840  1754 2404 3279  5015  7243  11048 16532 27073 38392 55466
asymm_qsort() 271  389  396  587  888  1509 2306 3302  4808  7156  10784 16084 24763 36098 54557
merge_array() 354  357  527  796  1216 2219 3271 4559  6874  10914 16874 25979 38948 58491 90157

8
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      233  242  360  554  803  1626 2310 3595  4808  7208  10370 16420 23947 38687 56117
quick_hole()  243  262  383  586  899  1536 2323 3616  5021  7424  10249 16716 24281 37119 58152
asymm_qsort() 258  266  397  610  892  1558 2302 3344  4972  7159  10444 15953 23809 36157 54543
merge_array() 235  352  534  796  1252 2269 3262 4700  6955  10816 16940 25943 38971 58604 90136

9
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      505  763  358  551  826  1625 2324 3286  4816  7252  10316 16376 24032 38312 56210
quick_hole()  202  259  397  645  856  1535 2482 3337  4977  7108  10299 15780 24540 37003 56112
asymm_qsort() 182  272  398  592  877  1580 2313 3292  5003  7153  10385 15730 23856 36076 54762
merge_array() 236  360  525  800  1242 2277 3266 4677  6933  11032 16705 26017 39005 58676 90104

10
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      510  761  370  555  827  1594 2261 3350  4705  7268  10341 16718 23562 38558 56203
quick_hole()  172  259  403  590  886  1566 2292 3266  4594  7258  10451 16071 25409 37545 56781
asymm_qsort() 181  272  401  607  880  1504 2229 3318  4758  7247  10592 16101 23792 36225 54977
merge_array() 236  359  532  800  1234 2281 3222 4649  6856  11065 16985 26439 38749 58641 90617

11
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      500  727  371  553  829  1600 2315 3544  4842  7311  10271 16426 23955 38740 56012
quick_hole()  179  257  386  560  856  1514 2645 3428  5339  8148  11029 16230 24503 37856 57185
asymm_qsort() 182  269  406  584  864  1542 2291 3323  4894  7297  10401 16430 23925 37710 54692
merge_array() 240  356  526  787  1259 2268 3251 4738  6894  11033 16735 25792 38724 59325 90031

12
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      493  766  357  548  831  1617 2304 3362  4835  7284  10134 16664 23610 38630 56292
quick_hole()  539  264  381  583  866  1589 2296 3504  5087  8146  10953 17691 24251 36966 57483
asymm_qsort() 183  271  389  596  907  1550 2228 3366  4840  7281  10489 16417 24060 36084 54629
merge_array() 239  360  515  830  1337 2269 3228 4651  6915  11287 16965 26231 39792 58786 89884

13
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      514  567  371  557  798  1645 2322 3342  4802  7470  10057 16412 24169 38725 56325
quick_hole()  173  264  392  567  841  1762 2588 3328  4757  7373  10809 17380 25522 36416 60330
asymm_qsort() 187  273  398  586  868  1619 2316 3337  4795  7222  10549 16190 25307 36468 55646
merge_array() 236  362  521  786  1228 2265 3233 4610  6932  11015 17017 26147 39271 58583 90316

14
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      516  760  536  551  827  1620 2257 3540  4840  7283  9800  16367 23585 37669 56063
quick_hole()  173  259  406  577  852  1539 2297 3264  4950  7724  10558 15878 24394 36389 57786
asymm_qsort() 182  266  398  594  882  1522 2257 3359  4896  7288  10407 16016 23980 36090 57506
merge_array() 236  380  524  810  1245 2211 3269 4655  6891  10936 16647 25964 38968 58383 90867

15
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      511  251  359  561  794  1629 2346 3457  4842  7246  10187 16191 24020 38044 56015
quick_hole()  172  261  398  606  848  1553 2217 3473  5122  7553  11952 16882 24637 35840 57415
asymm_qsort() 179  272  395  600  852  1548 2306 3278  4885  7258  10689 15935 23883 36300 55208
merge_array() 236  359  515  801  1228 2239 3254 4682  6920  11160 17122 25765 38933 58405 90600

16
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      510  562  371  555  836  1622 2275 3530  4843  7226  10290 16478 23561 38329 56179
quick_hole()  177  259  386  577  844  1474 2384 3284  5169  7230  10984 15684 24645 37738 56230
asymm_qsort() 181  269  402  589  884  1534 2208 3385  4921  7100  10598 15697 23783 37737 54776
merge_array() 237  356  528  812  1251 2230 3271 4740  6947  11079 16850 25795 38954 58840 90123

17
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      513  427  355  555  824  1591 2353 3277  4864  7386  10201 16389 24041 38246 56243
quick_hole()  176  267  383  571  857  1472 2333 3289  5089  7932  10656 16224 24680 37860 55800
asymm_qsort() 181  276  394  595  896  1540 2301 3222  4847  7211  10579 15993 25394 36001 55036
merge_array() 236  353  518  808  1234 2287 3306 4672  6930  10940 16864 26084 39308 58358 90262

18
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      507  447  356  533  807  1636 2328 3548  4833  7282  10294 16403 24090 37509 56164
quick_hole()  211  255  373  580  858  1671 2184 3364  5518  7588  10834 15996 24170 38801 57328
asymm_qsort() 183  273  387  588  867  1528 2248 3394  4935  7289  10691 15770 24370 36670 54717
merge_array() 236  360  515  809  1229 2280 3232 4672  7077  10924 16832 25712 39076 58268 90026

19
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      503  242  370  554  839  1640 2388 3490  4812  7152  10067 16456 23485 37931 55520
quick_hole()  264  259  404  574  873  1643 2605 3358  5159  7538  11051 16074 24327 38021 56338
asymm_qsort() 263  270  404  602  883  1532 2333 3367  4942  7281  10467 15705 24138 35960 54767
merge_array() 239  357  519  804  1218 2228 3245 4732  6980  10977 16816 25627 38634 58357 89696

20
log2(N)       1024 1448 2048 2896 4096 5793 8192 11585 16384 23170 32768 46341 65536 92682 131072
qsort(3)      513  240  370  536  826  1632 2374 3526  4528  7255  10078 16127 23986 38811 56179
quick_hole()  174  263  386  568  842  1614 2334 3264  4924  7023  10086 15615 24895 36899 56010
asymm_qsort() 183  269  404  583  866  1599 2305 3359  4940  7234  10494 16072 24792 38011 54616
merge_array() 237  359  525  806  1256 2225 3235 4748  6819  10840 16722 26167 39043 59222 89951

@
